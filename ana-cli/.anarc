#!/bin/bash

# Let's define some basic project variables
export PROJECT_NAME=ana
export USERNAME=austinagi

# The current directory
export SCRIPT_DIR=$(dirname $(realpath $0))
# The root directory of the project
export ROOT_DIR=$(dirname $SCRIPT_DIR)
# The path to the config directory
export CONFIG_DIR=$ROOT_DIR/config
# The root directory of the ANa API
export API_ROOT_DIR=$ROOT_DIR/ana-api
# The root directory of the ANa UI
export UI_ROOT_DIR=$ROOT_DIR/ana-ui
# The root directory of the ANa language model
export CORE_ROOT_DIR=$ROOT_DIR/ana-core
# The root directory of the ANa CLI 
export CLI_ROOT_DIR=$ROOT_DIR/ana-cli

# For the curious ;)
alias vela="cd $CORE_ROOT_DIR"
alias puppis="cd $UI_ROOT_DIR"
alias carina="cd $API_ROOT_DIR"
alias argo="cd $ROOT_DIR"

# Utility functions 
# Show a usage message if no arguments are passed
exitWithMessageIfNoArgs() {
    if [ $# -eq 0 ]; then
        echo "error: no exit message provided"
        exit 1
    elif [ $# -eq 1 ]; then
        echo "$1"
        exit 1
    fi
}
export -f exitWithMessageIfNoArgs

isValidComponent() {
    if [ $# -eq 0 ]; then
        echo "error: no component specified"
        exit 1
    fi

    COMPONENTS=("ui" "api" "core")
    for component in "${COMPONENTS[@]}"; do
        if [[ $component = $1 ]]; then 
            return 0
        fi
    done 
    return 1 
}

getConfigValue() {
    if [ ! -f $2 ]; then
        echo "No such file '$2'" >&2
        exit 1
    fi

    config_value=$(awk -F "=" -v pattern="$1" '$1~pattern {print $2}' $2)
    if [ $? -ne 0 ] || [ -z "$config_value" ]; then
        echo "Value '$1' could not be retrieved from '$2'" > /dev/stderr
        exit 1
    fi

    echo $config_value
    exit 0
}
export -f isValidComponent